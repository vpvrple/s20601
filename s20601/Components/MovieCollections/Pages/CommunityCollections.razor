@page "/community-collections"

@using s20601.Components.Users.Components
@using s20601.Services
@using s20601.Data.Models.DTOs

@inject IMovieCollectionService MovieCollectionSvc

@if (_loading)
{
     <MudProgressLinear Indeterminate="true" />
}
else if (_movieCollections?.Count == 0)
{
    <MudText Typo="Typo.body1">Nothing here, someone has to be the first!</MudText>
}
else if (_movieCollections != null)
{
    <MudStack AlignItems="AlignItems.Baseline">
        @foreach (var collection in _movieCollections)
        {
            <MudLink Href="@($"/movie-collection/{collection.Id}")"
                     Underline="Underline.None">
            <MudStack Row="true">
                <MudPaper Elevation="1">
                    <MudPaper Class="d-flex align-center justify-center" Elevation="0" Style="width: 100%; aspect-ratio: 2/3;">
                        <MudIcon Icon="@Icons.Material.Filled.List" Style="font-size: 6rem;" />
                    </MudPaper>
                </MudPaper>
                <MudPaper Elevation="0">
                    <MudStack>
                        

                        <MudText Typo="Typo.h5" Align="Align.Start">
                            <MudStack Row="true">
                                @(_movieCollections.IndexOf(collection) + 1). @collection.Name
                                <MudAvatarGroup Max="5">
                                    @foreach (var user in collection.Members)
                                    {
                                        <UserAvatar UserId="@user.Key.Id"></UserAvatar>
                                    }
                                </MudAvatarGroup>
                            </MudStack>
                            
                            <MudText Typo="Typo.body2">
                                @(collection.Description.Length > 100 ? $"{collection.Description.Substring(0, 100)}..." : collection.Description)
                            </MudText>
                        </MudText>
                        
                        
                        

                            
                                
                        
                                <MudText Typo="Typo.subtitle2">
                                    Movies: @collection.MovieCount</MudText>

                                <MudText Typo="Typo.subtitle2">Created
                                    at: @collection.CreatedAt.ToShortDateString()</MudText>
                            
                    </MudStack>
                </MudPaper>
            </MudStack>
            </MudLink>
                
        }
    </MudStack>
        
}

@code
{
    private bool _loading;
    private List<GetMovieCollectionWithDetails> _movieCollections = null!; 

    protected override async Task OnInitializedAsync()
    {
        _loading = true;
        _movieCollections = await MovieCollectionSvc.GetCommunityMovieCollections();
        _loading = false;
    }
}
