@using s20601.Data.Models

@inject IDialogService DialogService

<AuthorizeView Policy="PointsAtLeast21">
    <Authorized>
        <MudButton Color="@Color" Variant="@Variant" EndIcon="@Icons.Material.Filled.Edit" OnClick="@OpenMovieRequestDialog">@ButtonText</MudButton>
    </Authorized>
</AuthorizeView>


@code {
    [Parameter]
    public Movie? Movie { get; set; }
    [Parameter]
    public required string DialogTitle { get; set; }
    [Parameter]
    public required string ButtonText { get; set; }
    [Parameter] public Variant Variant { get; set; } = Variant.Filled;
    [Parameter] public Color Color { get; set; } = Color.Primary;
    [Parameter] public EventCallback OnRequestSubmitted { get; set; }
    
    private async Task OpenMovieRequestDialog()
    {
        var parameters = new DialogParameters<MovieRequestDialog>
        {
            { x => x.Movie, Movie }
        };

        var dialog = await DialogService.ShowAsync<MovieRequestDialog>(DialogTitle, parameters);
        var result = await dialog.Result;

        if (!result.Canceled && result.Data is bool success && success)
        {
            await OnRequestSubmitted.InvokeAsync();
        }
    }
}